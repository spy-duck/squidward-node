services:
  squidward-node:
    container_name: squidwardproxy/squidward-node
    restart: unless-stopped

  squidward-redis:
    image: valkey/valkey:9.0-alpine3.22
    container_name: squidward-redis
    hostname: squidward-redis
    restart: always
    networks:
      squidward-node-internal:
    expose:
      - '6379'
    volumes:
      - squidward-redis-vol:/data
    environment:
      - VALKEY_PASSWORD_FILE=/run/secrets/valkey-password
    command: /bin/sh -c "redis-server --requirepass $$(cat $$REDIS_PASSWORD_FILE)"

    secrets:
      - redis_password

secrets:
  redis_password:
    environment: REDIS_PASSWORD

networks:
  squidward-node-internal:
    name: squidward_node_internal
    internal: true
  squidward-node-external:
    name: squidward_node_external
    driver: bridge